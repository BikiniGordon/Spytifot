{% extends "base.html" %}
{% block title %}Search - Spytifot{% endblock %}

{% block head_extra %}
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">

<style>
  body {
    font-family: 'Poppins', sans-serif;
  }

  .search-box {
    display: flex;
    align-items: center;
    gap: 12px;
    margin-bottom: 24px;
  }

  #searchInput {
    flex: 1;
    padding: 16px 22px;
    font-size: 1.15rem;
    border-radius: 14px;
    border: none;
    outline: none;
    background: rgba(255,255,255,0.08);
    color: #fff;
    box-shadow: 0 0 0 2px rgba(155,89,182,0.15);
    transition: all 0.25s ease;
  }

  #searchInput:focus {
    background: rgba(255,255,255,0.16);
    box-shadow: 0 0 10px rgba(155,89,182,0.4);
    transform: scale(1.02);
  }

  .btn-primary {
    background: linear-gradient(90deg, #9b59b6, #764ba2);
    color: #fff;
    font-weight: 600;
    padding: 14px 26px;
    border-radius: 12px;
    border: none;
    cursor: pointer;
    transition: all 0.25s ease;
    box-shadow: 0 4px 10px rgba(0,0,0,0.25);
  }

  .btn-primary:hover {
    background: linear-gradient(90deg, #b57ee5, #8e5fc1);
    transform: scale(1.08);
    box-shadow: 0 6px 16px rgba(155,89,182,0.5);
  }

  #resultsBox {
    background: rgba(255,255,255,0.04);
    border-radius: 12px;
    padding: 14px;
    margin-top: 20px;
    max-height: 420px;
    overflow-y: auto;
    border: 1px solid rgba(255,255,255,0.08);
  }

  #resultsBox::-webkit-scrollbar {
    width: 8px;
  }
  #resultsBox::-webkit-scrollbar-thumb {
    background: linear-gradient(180deg, #9b59b6, #764ba2);
    border-radius: 6px;
  }

  .song-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    background: rgba(255,255,255,0.03);
    padding: 12px 14px;
    border-radius: 8px;
    margin-bottom: 10px;
    transition: 0.2s ease;
  }

  .song-item:hover {
    background: rgba(155,89,182,0.15);
    transform: translateX(4px);
  }

  .song-title {
    font-weight: 600;
    font-size: 1rem;
    color: #fff;
  }

  .small {
    font-size: 0.85rem;
    color: rgba(255,255,255,0.7);
  }

  .message-toast {
    position: fixed;
    top: 22px;
    right: 22px;
    background: linear-gradient(90deg,#28a745,#3ddc84);
    color: #fff;
    padding: 14px 20px;
    border-radius: 10px;
    font-weight: 600;
    z-index: 999;
    box-shadow: 0 4px 12px rgba(0,0,0,0.3);
    animation: fadeInOut 3.5s ease forwards;
  }

  @keyframes fadeInOut {
    0% {opacity: 0; transform: translateY(-10px);}
    10%,90% {opacity: 1; transform: translateY(0);}
    100% {opacity: 0; transform: translateY(-10px);}
  }
</style>
{% endblock %}

{% block content %}
  <div class="container-card">
    <h2 style="font-size:1.9rem;color:#fff;margin-bottom:18px;font-weight:700;">Search</h2>
    <p class="small" style="margin-bottom:12px;color:rgba(255,255,255,0.6)">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÄ‡∏û‡∏•‡∏á‡∏´‡∏£‡∏∑‡∏≠‡∏®‡∏¥‡∏•‡∏õ‡∏¥‡∏ô ‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏û‡∏•‡∏¢‡πå‡∏•‡∏¥‡∏™‡∏ï‡πå‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì üé∂</p>

    <div class="search-box">
      <input id="searchInput" placeholder="üîç Search for songs or artists..." />
      <button class="btn-primary" onclick="searchSongs()">Search</button>
    </div>

    <div id="resultsBox">
      <div id="searchResults" class="small" style="color:rgba(255,255,255,0.5);text-align:center;">
        ‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏û‡∏•‡∏á‡∏´‡∏£‡∏∑‡∏≠‡∏®‡∏¥‡∏•‡∏õ‡∏¥‡∏ô‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡∏î Search ‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢ üéß
      </div>
    </div>
  </div>
{% endblock %}

{% block body_extra %}
<script>
  // Toast ‡πÅ‡∏™‡∏î‡∏á‡∏ï‡∏≠‡∏ô‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏û‡∏•‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
  function showToast(message) {
    const toast = document.createElement('div');
    toast.className = 'message-toast';
    toast.textContent = message;
    document.body.appendChild(toast);
    setTimeout(() => toast.remove(), 3500);
  }

  // override addToPlaylist
  async function addToPlaylist(songId){
    try{
      const data = await fetch('/api/playlist/add', {
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body: JSON.stringify({song_id:songId})
      }).then(res => res.json());

      if(data.success){
        showToast('‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏û‡∏•‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!');
        showMessage(data.message,'success');
        await loadPlaylist();
      } else {
        showMessage(data.error||'Add failed','error');
      }
    }catch(e){
      showMessage('Error adding song to playlist','error');
    }
  }
</script>
{% endblock %}
